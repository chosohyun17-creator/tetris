<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Tetris - Ranking Edition</title>
    <style>
        /* ìŠ¤íƒ€ì¼ ì„¤ì • */
        body {
            font-family: 'Malgun Gothic', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #2c3e50;
            color: #ecf0f1;
            overflow: hidden;
        }

        .game-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            border-radius: 10px;
            background-color: #34495e;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            position: relative;
        }

        /* ê²Œì„ ë³´ë“œ */
        #game-board {
            --cell-size: 25px;
            width: calc(var(--cell-size) * 10);
            height: calc(var(--cell-size) * 20);
            border: 4px solid #2980b9;
            background-color: #1c2833;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
        }

        .block { box-sizing: border-box; border: 1px solid rgba(255,255,255,0.1); }
        
        /* ë¸”ë¡ ìƒ‰ìƒ */
        .I { background-color: #00FFFF; }
        .O { background-color: #FFFF00; }
        .T { background-color: #800080; }
        .S { background-color: #00FF00; }
        .Z { background-color: #FF0000; }
        .J { background-color: #0000FF; }
        .L { background-color: #FF7F00; }

        /* ì •ë³´ íŒ¨ë„ */
        .info-panel { width: 180px; display: flex; flex-direction: column; gap: 10px; }
        
        #next-block {
            width: 100px; height: 100px;
            display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr);
            border: 2px solid #5499c7; background-color: #1c2833;
        }
        .next-cell { box-sizing: border-box; border: 1px solid rgba(255,255,255,0.05); }

        /* ëª¨ë‹¬ ì‹œìŠ¤í…œ */
        .modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9); padding: 25px; border-radius: 15px;
            text-align: center; z-index: 100; min-width: 260px; border: 2px solid #2980b9;
        }
        .hidden { display: none !important; }

        input { padding: 10px; width: 80%; margin-bottom: 15px; border-radius: 5px; border: none; font-size: 16px; }
        button {
            padding: 12px 20px; background-color: #2ecc71; border: none;
            color: white; cursor: pointer; border-radius: 5px; font-weight: bold;
        }
        button:hover { background-color: #27ae60; }
        
        .rank-list { text-align: left; margin: 15px 0; max-height: 200px; overflow-y: auto; font-size: 14px; }
        .rank-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #444; }
    </style>
</head>
<body>

    <div class="game-container">
        <div id="game-board"></div>

        <div class="info-panel">
            <h2 style="margin:0; color:#3498db;">TETRIS</h2>
            <div style="background:#2c3e50; padding:10px; border-radius:5px;">
                <p style="margin:5px 0;">Player: <b id="display-name">-</b></p>
                <p style="margin:5px 0;">Score: <b id="score" style="color:#f1c40f;">0</b></p>
            </div>
            <p style="margin:5px 0;">Next Block:</p>
            <div id="next-block"></div>
            <button id="rank-btn" style="background-color:#34495e; border:1px solid #7f8c8d;">Ranking</button>
        </div>

        <div id="start-modal" class="modal">
            <h2 style="color:#2ecc71;">New Game</h2>
            <input type="text" id="player-name" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="8">
            <br>
            <button id="start-btn">ê²Œì„ ì‹œì‘</button>
        </div>

        <div id="rank-modal" class="modal hidden">
            <h2>ğŸ† Top 10</h2>
            <div id="rank-content" class="rank-list"></div>
            <button id="close-rank">ë‹«ê¸°</button>
        </div>

        <div id="game-over-modal" class="modal hidden">
            <h2 style="color:#e74c3c;">Game Over</h2>
            <p>ìµœì¢… ì ìˆ˜: <span id="final-score">0</span></p>
            <button id="restart-btn">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        // ê²Œì„ ì„¤ì •
        const ROWS = 20, COLS = 10;
        const TETROMINOES = {
            'I': [[0,0,0,0], [1,1,1,1], [0,0,0,0], [0,0,0,0]],
            'J': [[1,0,0], [1,1,1], [0,0,0]],
            'L': [[0,0,1], [1,1,1], [0,0,0]],
            'O': [[1,1], [1,1]],
            'S': [[0,1,1], [1,1,0], [0,0,0]],
            'T': [[0,1,0], [1,1,1], [0,0,0]],
            'Z': [[1,1,0], [0,1,1], [0,0,0]]
        };
        const COLORS = { 'I':'I','J':'J','L':'L','O':'O','S':'S','T':'T','Z':'Z' };

        let board = [], currentPiece = null, nextPieceType = null;
        let score = 0, gameInterval = null, playerName = "";

        // ì´ˆê¸°í™”
        function init() {
            board = Array(ROWS).fill(0).map(() => Array(COLS).fill(0));
            const boardEl = document.getElementById('game-board');
            boardEl.innerHTML = '';
            for(let i=0; i<ROWS*COLS; i++) boardEl.appendChild(document.createElement('div')).classList.add('block');
            
            const nextEl = document.getElementById('next-block');
            nextEl.innerHTML = '';
            for(let i=0; i<16; i++) nextEl.appendChild(document.createElement('div')).classList.add('next-cell');
        }

        // ë¸”ë¡ ìƒì„±
        function createPiece() {
            const type = nextPieceType || Object.keys(TETROMINOES)[Math.floor(Math.random()*7)];
            nextPieceType = Object.keys(TETROMINOES)[Math.floor(Math.random()*7)];
            currentPiece = {
                type: type,
                shape: TETROMINOES[type],
                x: Math.floor(COLS/2) - Math.floor(TETROMINOES[type][0].length/2),
                y: 0
            };
            drawNext();
            if(collide()) return false;
            return true;
        }

        // ì¶©ëŒ ê²€ì‚¬
        function collide(nx = 0, ny = 0, newShape = null) {
            const shape = newShape || currentPiece.shape;
            for(let r=0; r<shape.length; r++) {
                for(let c=0; c<shape[r].length; c++) {
                    if(shape[r][c]) {
                        let targetX = currentPiece.x + c + nx;
                        let targetY = currentPiece.y + r + ny;
                        if(targetX < 0 || targetX >= COLS || targetY >= ROWS || (targetY >= 0 && board[targetY][targetX])) return true;
                    }
                }
            }
            return false;
        }

        // ë¸”ë¡ ê³ ì •
        function lock() {
            currentPiece.shape.forEach((row, r) => {
                row.forEach((val, c) => {
                    if(val) board[currentPiece.y + r][currentPiece.x + c] = currentPiece.type;
                });
            });
            clearLines();
            if(!createPiece()) gameOver();
        }

        // ì¤„ ì‚­ì œ
        function clearLines() {
            let rowsCleared = 0;
            for(let r = ROWS - 1; r >= 0; r--) {
                if(board[r].every(cell => cell !== 0)) {
                    board.splice(r, 1);
                    board.unshift(Array(COLS).fill(0));
                    rowsCleared++;
                    r++;
                }
            }
            if(rowsCleared > 0) {
                score += [0, 100, 300, 500, 800][rowsCleared];
                document.getElementById('score').textContent = score;
            }
        }

        // í™”ë©´ ê·¸ë¦¬ê¸°
        function draw() {
            const cells = document.querySelectorAll('#game-board .block');
            board.forEach((row, r) => {
                row.forEach((val, c) => {
                    const cell = cells[r * COLS + c];
                    cell.className = 'block' + (val ? ' ' + val : '');
                });
            });
            if(currentPiece) {
                currentPiece.shape.forEach((row, r) => {
                    row.forEach((val, c) => {
                        if(val) {
                            const idx = (currentPiece.y + r) * COLS + (currentPiece.x + c);
                            if(idx >= 0 && idx < cells.length) cells[idx].className = 'block ' + currentPiece.type;
                        }
                    });
                });
            }
        }

        function drawNext() {
            const cells = document.querySelectorAll('.next-cell');
            cells.forEach(c => c.className = 'next-cell');
            const shape = TETROMINOES[nextPieceType];
            shape.forEach((row, r) => {
                row.forEach((val, c) => {
                    if(val) {
                        const idx = (r + (nextPieceType==='I'?0:1)) * 4 + (c + (nextPieceType==='I'?0:1));
                        if(cells[idx]) cells[idx].className = 'next-cell ' + nextPieceType;
                    }
                });
            });
        }

        // ë­í‚¹ ì €ì¥/ë¡œë“œ
        function handleRanking() {
            let ranks = JSON.parse(localStorage.getItem('tetrisRank') || '[]');
            ranks.push({ name: playerName, score: score });
            ranks.sort((a,b) => b.score - a.score);
            localStorage.setItem('tetrisRank', JSON.stringify(ranks.slice(0, 10)));
        }

        function showRank() {
            const ranks = JSON.parse(localStorage.getItem('tetrisRank') || '[]');
            const content = document.getElementById('rank-content');
            content.innerHTML = ranks.map((r, i) => `
                <div class="rank-item">
                    <span>${i+1}. ${r.name}</span>
                    <span>${r.score}</span>
                </div>
            `).join('') || "ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";
            document.getElementById('rank-modal').classList.remove('hidden');
        }

        // ê²Œì„ ì œì–´
        function gameOver() {
            clearInterval(gameInterval);
            gameInterval = null;
            handleRanking();
            document.getElementById('final-score').textContent = score;
            document.getElementById('game-over-modal').classList.remove('hidden');
        }

        function startGame() {
            const nameInput = document.getElementById('player-name').value.trim();
            if(!nameInput) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            playerName = nameInput;
            document.getElementById('display-name').textContent = playerName;
            document.getElementById('start-modal').classList.add('hidden');
            document.getElementById('game-over-modal').classList.add('hidden');
            score = 0;
            document.getElementById('score').textContent = "0";
            init();
            createPiece();
            if(gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(() => {
                if(!collide(0, 1)) currentPiece.y++;
                else lock();
                draw();
            }, 800);
        }

        // í‚¤ ì…ë ¥
        document.addEventListener('keydown', e => {
            if(!gameInterval) return;
            if(e.key === 'ArrowLeft' && !collide(-1, 0)) currentPiece.x--;
            if(e.key === 'ArrowRight' && !collide(1, 0)) currentPiece.x++;
            if(e.key === 'ArrowDown' && !collide(0, 1)) currentPiece.y++;
            if(e.key === 'ArrowUp') {
                const rotated = currentPiece.shape[0].map((_, i) => currentPiece.shape.map(row => row[i]).reverse());
                if(!collide(0, 0, rotated)) currentPiece.shape = rotated;
            }
            if(e.key === ' ') {
                while(!collide(0, 1)) currentPiece.y++;
                lock();
            }
            draw();
        });

        document.getElementById('start-btn').addEventListener('click', startGame);
        document.getElementById('rank-btn').addEventListener('click', showRank);
        document.getElementById('close-rank').addEventListener('click', () => document.getElementById('rank-modal').classList.add('hidden'));
        document.getElementById('restart-btn').addEventListener('click', () => document.getElementById('start-modal').classList.remove('hidden'));

        init();
    </script>
</body>
</html>
